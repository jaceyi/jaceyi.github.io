<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="keywords"
    content="jaceyi,yijinchun,Jace,JaceYi,Jace Yi,æ˜“è¿›æ˜¥,æ˜“è¿›æ˜¥çš„åšå®¢,yiä¸ªç¨‹åºçŒ¿,å‰ç«¯,å‰ç«¯å¼€å‘,å‰ç«¯åšå®¢,JavaScript,React">
  <meta name="description" content="æ˜“è¿›æ˜¥çš„ä¸ªäººåšå®¢ï¼Œåˆ†äº«æ—¥å¸¸ç”Ÿæ´»ã€å­¦ä¹ ç¬”è®°å’Œè¸©è¿‡çš„é‚£äº›å‘~" />
  <title>è¯¦è§£ React useCallback & useMemo - æ˜“è¿›æ˜¥çš„åšå®¢ã€Webå‰ç«¯å¼€å‘ã€‘</title>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/css/prism.css">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/post.css">
  <script src="/js/util.js"></script>
</head>

<body>
  <div id="header" style="background-image: url(/static/images/bg4.jpg)">
    <div class="bar">
  <div class="title">
    <a href="/">Jace's Blog</a>
  </div>
  <nav class="nav">
    <div class="item">
      <a href="/">Home</a>
    </div>
    <div class="item">
      <a href="/tags">Tags</a>
    </div>
    <div class="item">
      <a href="/about">About</a>
    </div>
  </nav>
  <div class="mobile-nav">
    <div class="mobile-nav-menu icon">
      <i class="iconfont">&#xe633;</i>
    </div>
    <div class="mobile-nav-box">
      <a href="/">Home</a>
      <a href="/tags">Tags</a>
      <a href="/about">About</a>
    </div>
  </div>
</div>

<script>
  (function (d, w) {
    w.onload = function () {
      var $menuIcon = d.querySelector('.mobile-nav-menu');
      var $navBox = d.querySelector('.mobile-nav-box');
      var animationEndCallback = null;
      function hideNavBox() {
        addClass($navBox, 'zoomOut');
        animationEndCallback = function () {
          removeClass($navBox, 'zoomOut');
          $navBox.style.display = 'none';
        }
      }

      $menuIcon.onclick = function (e) {
        e.stopPropagation();
        if ($navBox.style.display === 'block') return hideNavBox();
        $navBox.style.display = 'block';
        addClass($navBox, 'zoomIn');
        animationEndCallback = function () {
          removeClass($navBox, 'zoomIn');
        }
      };

      $navBox.onclick = function (e) {
        e.stopPropagation();
      };

      $navBox.addEventListener('animationend', function (e) {
        animationEndCallback && animationEndCallback();
      }, false);

      d.body.addEventListener('click', function () {
        if ($navBox.style.display === 'block') hideNavBox();
      }, false);

      var $header = d.querySelector('#header');
      var $bar = d.querySelector('.bar');
      var barHeight = $bar.offsetHeight;
      w.addEventListener('scroll', function (e) {
        var scrollTop = d.documentElement.scrollTop || d.body.scrollTop;
        var step = $header.className.indexOf('visible') >= 0 ? barHeight : 0;
        if (scrollTop > $header.offsetHeight - step) {
          addClass($header, 'active');
        } else {
          removeClass($header, 'active');
        }
      }, false);

      d.addEventListener('mousewheel', function (e) {
        if (e.target.tagName === 'BODY') {
          if (e.wheelDeltaY >= 0) {
            addClass($header, 'visible');
          } else {
            removeClass($header, 'visible');
          }
        }
      })
    }
  })(document, window);
</script>

    <div class="content">
      <h1 class="post-title">è¯¦è§£ React useCallback & useMemo</h1>
      <div class="post-description">æœ¬æ–‡è¯¦ç»†çš„è®²è¿°äº† useCallback ä¸ useMemo çš„ä½¿ç”¨åœºæ™¯ï¼Œä»¥åŠæœ‰å“ªäº›ä½¿ç”¨ä¸­å¸¸é‡åˆ°çš„é—®é¢˜ä¸é‡‡å‘ç‚¹ã€‚</div>
      <div class="post-date">2020-03-24</div>
      <div class="tags">
        
        <a class="tag" href="/tags/#JavaScript" title="JavaScript">JavaScript</a>
        
        <a class="tag" href="/tags/#React" title="React">React</a>
        
      </div>
    </div>
  </div>

  <div class="container">
    <div class="main">
      <div class="article">
        <h2 id="å‰è¨€">å‰è¨€</h2>

<p>é˜…è¯»æœ¬æ–‡ç« éœ€è¦å¯¹ <a href="https://reactjs.org/docs/hooks-intro.html">React hooks</a> ä¸­ <a href="https://reactjs.org/docs/hooks-state.html">useState</a> å’Œ <a href="https://reactjs.org/docs/hooks-effect.html">useEffect</a> æœ‰åŸºç¡€çš„äº†è§£ã€‚æˆ‘çš„è¿™ç¯‡æ–‡ç« å†…æœ‰å¤§è‡´ä»‹ç» <a href="https://juejin.cn/post/6844904093824073742">åœ¨ React é¡¹ç›®ä¸­å…¨é‡ä½¿ç”¨ Hooks</a>ã€‚</p>

<!--more-->

<h2 id="usecallback">useCallback</h2>

<h3 id="usecallback-çš„ä½œç”¨">useCallback çš„ä½œç”¨</h3>

<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>

<blockquote>
  <p>Pass an inline callback and an array of dependencies. useCallback will return a memoized version of the callback that only changes if one of the dependencies has changed.</p>
</blockquote>

<p>ç®€å•æ¥è¯´å°±æ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šæ›´æ–°ï¼ˆè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼‰ã€‚</p>

<h3 id="usecallback-çš„åº”ç”¨">useCallback çš„åº”ç”¨</h3>

<p>åœ¨çº¿ä»£ç ï¼š <a href="https://codesandbox.io/s/usecallback1-yu1sp">Code Sandbox</a></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useCallback</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Button</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Button</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">count1</span><span class="p">,</span> <span class="nx">setCount1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">count2</span><span class="p">,</span> <span class="nx">setCount2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">count3</span><span class="p">,</span> <span class="nx">setCount3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">handleClickButton1</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount1</span><span class="p">(</span><span class="nx">count1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">handleClickButton2</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount2</span><span class="p">(</span><span class="nx">count2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">count2</span><span class="p">]);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Button</span> <span class="nx">onClickButton</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClickButton1</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Button1</span><span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Button</span> <span class="nx">onClickButton</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClickButton2</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Button2</span><span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Button</span>
          <span class="nx">onClickButton</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">setCount3</span><span class="p">(</span><span class="nx">count3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
          <span class="p">}}</span>
        <span class="o">&gt;</span>
          <span class="nx">Button3</span>
        <span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Button.jsx</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">Button</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onClickButton</span><span class="p">,</span> <span class="nx">children</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClickButton</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">Button</span><span class="p">);</span>
</code></pre></div></div>

<p>åœ¨æ¡ˆä¾‹ä¸­å¯ä»¥åˆ†åˆ«ç‚¹å‡» Demo ä¸­çš„å‡ ä¸ªæŒ‰é’®æ¥æŸ¥çœ‹æ•ˆæœï¼š</p>

<ul>
  <li>ç‚¹å‡» Button1 çš„æ—¶å€™åªä¼šæ›´æ–° Button1 å’Œ Button3 åé¢çš„å†…å®¹;</li>
  <li>ç‚¹å‡» Button2 ä¼šå°†ä¸‰ä¸ªæŒ‰é’®åçš„å†…å®¹éƒ½æ›´æ–°;</li>
  <li>ç‚¹å‡» Button3 çš„ä¹Ÿæ˜¯åªæ›´æ–° Button1 å’Œ Button3 åé¢çš„å†…å®¹ã€‚</li>
</ul>

<p>ä¸Šè¿°æ•ˆæœä»”ç»†ç†ä¸€ç†å°±å¯ä»¥å‘ç°ï¼Œåªæœ‰ç»è¿‡ <code class="language-plaintext highlighter-rouge">useCallback</code> ä¼˜åŒ–åçš„ Button2 æ˜¯ç‚¹å‡»è‡ªèº«æ—¶æ‰ä¼šå˜æ›´ï¼Œå…¶ä»–çš„ä¸¤ä¸ªåªè¦çˆ¶ç»„ä»¶æ›´æ–°åéƒ½ä¼šå˜æ›´ï¼ˆè¿™é‡Œ Button1 å’Œ Button3 å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œæ— éå°±æ˜¯å‡½æ•°æ¢äº†ä¸ªåœ°æ–¹å†™ï¼‰ã€‚ä¸‹é¢æˆ‘ä»¬ä»”ç»†çœ‹çœ‹å…·ä½“çš„ä¼˜åŒ–é€»è¾‘ã€‚</p>

<blockquote>
  <p>è¿™é‡Œæˆ–è®¸ä¼šæ³¨æ„åˆ° Button ç»„ä»¶çš„ <strong><a href="https://reactjs.org/docs/react-api.html#reactmemo"><code class="language-plaintext highlighter-rouge">React.memo</code></a></strong> è¿™ä¸ªæ–¹æ³•ï¼Œæ­¤æ–¹æ³•å†…ä¼šå¯¹ props åšä¸€ä¸ªæµ…å±‚æ¯”è¾ƒï¼Œå¦‚æœå¦‚æœ props æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œåˆ™ä¸ä¼šé‡æ–°æ¸²æŸ“æ­¤ç»„ä»¶ã€‚</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const a = () =&gt; {};
const b = () =&gt; {};
a === b; // false
</code></pre></div></div>

<p>ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸¤ä¸ªä¸€æ ·çš„å‡½æ•°å´æ˜¯ä¸ç›¸ç­‰çš„ï¼ˆè¿™æ˜¯ä¸ªåºŸè¯ï¼Œæˆ‘ç›¸ä¿¡èƒ½çœ‹åˆ°è¿™çš„äººéƒ½çŸ¥é“ï¼Œæ‰€ä»¥ä¸åšè§£é‡Šäº†ï¼‰ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">count1</span><span class="p">,</span> <span class="nx">setCount1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="c1">// ...</span>
<span class="kd">const</span> <span class="nx">handleClickButton1</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setCount1</span><span class="p">(</span><span class="nx">count1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">};</span>
<span class="c1">// ...</span>
<span class="k">return</span> <span class="o">&lt;</span><span class="nx">Button</span> <span class="nx">onClickButton</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClickButton1</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Button1</span><span class="o">&lt;</span><span class="sr">/Button&gt;</span><span class="err">;
</span></code></pre></div></div>

<p>å›å¤´å†çœ‹ä¸Šé¢çš„ <code class="language-plaintext highlighter-rouge">Button</code> ç»„ä»¶éƒ½éœ€è¦ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">onClickButton</code> çš„ props ï¼Œå°½ç®¡ç»„ä»¶å†…éƒ¨æœ‰ç”¨ <code class="language-plaintext highlighter-rouge">React.memo</code> æ¥åšä¼˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬å£°æ˜çš„ <code class="language-plaintext highlighter-rouge">handleClickButton1</code> æ˜¯ç›´æ¥å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´åªè¦æ˜¯çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ˆçŠ¶æ€æˆ–è€… props æ›´æ–°ï¼‰å°±ä¼šå¯¼è‡´è¿™é‡Œå£°æ˜å‡ºä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼Œæ–°çš„æ–¹æ³•å’Œæ—§çš„æ–¹æ³•å°½ç®¡é•¿çš„ä¸€æ ·ï¼Œä½†æ˜¯ä¾æ—§æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œ<code class="language-plaintext highlighter-rouge">React.memo</code> å¯¹æ¯”åå‘ç°å¯¹è±¡ props æ”¹å˜ï¼Œå°±é‡æ–°æ¸²æŸ“äº†ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">handleClickButton2</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setCount2</span><span class="p">(</span><span class="nx">count2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">count2</span><span class="p">]);</span>
</code></pre></div></div>

<p>ä¸Šè¿°ä»£ç æˆ‘ä»¬çš„æ–¹æ³•ä½¿ç”¨ useCallback åŒ…è£…äº†ä¸€å±‚ï¼Œå¹¶ä¸”åé¢è¿˜ä¼ å…¥äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">[count2]</code> å˜é‡ï¼Œè¿™é‡Œ useCallback å°±ä¼šæ ¹æ® <code class="language-plaintext highlighter-rouge">count2</code> æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå†³å®šæ˜¯å¦è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå‡½æ•°<strong>å†…éƒ¨ä½œç”¨åŸŸ</strong>ä¹Ÿéšä¹‹æ›´æ–°ã€‚</p>

<p>ç”±äºæˆ‘ä»¬çš„è¿™ä¸ªæ–¹æ³•åªä¾èµ–äº† <code class="language-plaintext highlighter-rouge">count2</code> è¿™ä¸ªå˜é‡ï¼Œè€Œä¸” <code class="language-plaintext highlighter-rouge">count2</code> <strong>åªåœ¨</strong>ç‚¹å‡» Button2 åæ‰ä¼šæ›´æ–° <code class="language-plaintext highlighter-rouge">handleClickButton2</code>ï¼Œæ‰€ä»¥å°±å¯¼è‡´äº†æˆ‘ä»¬ç‚¹å‡» Button1 ä¸é‡æ–°æ¸²æŸ“ Button2 çš„å†…å®¹ã€‚</p>

<h3 id="tips">Tips</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useCallback</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Button</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Button</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">count2</span><span class="p">,</span> <span class="nx">setCount2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">handleClickButton2</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setCount2</span><span class="p">(</span><span class="nx">count2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">Button</span> <span class="nx">count</span><span class="o">=</span><span class="p">{</span><span class="nx">count2</span><span class="p">}</span> <span class="nx">onClickButton</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClickButton2</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="nx">Button2</span>
    <span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æˆ‘ä»¬è°ƒæ•´äº†ä¸€ä¸‹ä»£ç ï¼Œå°† useCallback ä¾èµ–çš„ç¬¬äºŒä¸ªå‚æ•°å˜æˆäº†ä¸€ä¸ª<strong>ç©ºçš„æ•°ç»„</strong>ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªæ–¹æ³•æ²¡æœ‰ä¾èµ–å€¼ï¼Œå°†ä¸ä¼šè¢«æ›´æ–°ã€‚ä¸”ç”±äº JS çš„é™æ€ä½œç”¨åŸŸå¯¼è‡´æ­¤å‡½æ•°å†… <code class="language-plaintext highlighter-rouge">count2</code> æ°¸è¿œéƒ½ <code class="language-plaintext highlighter-rouge">0</code>ã€‚</p>

<p>å¯ä»¥ç‚¹å‡»å¤šæ¬¡ Button2 æŸ¥çœ‹å˜åŒ–ï¼Œä¼šå‘ç° Button2 åé¢çš„å€¼åªä¼šæ”¹å˜ä¸€æ¬¡ã€‚å› ä¸ºä¸Šè¿°å‡½æ•°å†…çš„ <code class="language-plaintext highlighter-rouge">count2</code> æ°¸è¿œéƒ½æ˜¯ <code class="language-plaintext highlighter-rouge">0</code>ï¼Œå°±æ„å‘³ç€æ¯æ¬¡éƒ½æ˜¯ <code class="language-plaintext highlighter-rouge">0 + 1</code>ï¼ŒButton æ‰€æ¥å—çš„ <code class="language-plaintext highlighter-rouge">count</code> propsï¼Œä¹Ÿåªä¼šä» <code class="language-plaintext highlighter-rouge">0</code> å˜æˆ <code class="language-plaintext highlighter-rouge">1</code>ä¸”ä¸€ç›´éƒ½å°†æ˜¯ <code class="language-plaintext highlighter-rouge">1</code>ï¼Œè€Œä¸” <code class="language-plaintext highlighter-rouge">handleClickButton2</code> ä¹Ÿå› æ²¡æœ‰ä¾èµ–é¡¹ä¸ä¼šè¿”å›æ–°çš„æ–¹æ³•ï¼Œå°±å¯¼è‡´ Button ç»„ä»¶åªä¼šå›  <code class="language-plaintext highlighter-rouge">count</code> æ”¹å˜è€Œæ›´æ–°ä¸€æ¬¡ã€‚</p>

<hr />

<p>ä¸Šè¿°æåˆ°çš„æ˜¯ä¸æ›´æ–°æ‰€å¸¦æ¥çš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥åœ¨çœ‹ä¸€ä¸ªé¢‘ç¹æ›´æ–°æ‰€å¸¦æ¥çš„é—®é¢˜ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">text</span><span class="p">,</span> <span class="nx">setText</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">handleSubmit</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">text</span><span class="p">]);</span>

<span class="k">return</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">text</span><span class="p">}</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setText</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">OtherForm</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div></div>

<p>ä¸Šè¿°ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ <code class="language-plaintext highlighter-rouge">handleSubmit</code> ä¼šä¾èµ– <code class="language-plaintext highlighter-rouge">text</code> çš„æ›´æ–°è€Œå»æ›´æ–°ï¼Œåœ¨ <code class="language-plaintext highlighter-rouge">input</code> çš„ä½¿ç”¨ä¸­ <code class="language-plaintext highlighter-rouge">text</code> çš„å˜åŒ–è‚¯å®šæ˜¯ç›¸å½“é¢‘ç¹çš„ï¼Œå‡å¦‚è¿™æ—¶å€™æˆ‘ä»¬çš„ <code class="language-plaintext highlighter-rouge">OtherForm</code> æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç»„ä»¶ï¼Œå¿…é¡»è¦è¿›è¡Œä¼˜åŒ–è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">useRef</code> æ¥å¸®å¿™ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">textRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">text</span><span class="p">,</span> <span class="nx">setText</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">handleSubmit</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">textRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
  <span class="c1">// ...</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">textRef</span><span class="p">]);</span>

<span class="k">return</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span>
      <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">text</span><span class="p">}</span>
      <span class="nx">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="p">{</span> <span class="nx">value</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
        <span class="nx">setText</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="nx">textRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
      <span class="p">}}</span>
    <span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">OtherForm</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div></div>

<p>ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">useRef</code> å¯ä»¥ç”Ÿæˆä¸€ä¸ªå˜é‡è®©å…¶åœ¨ç»„ä»¶æ¯ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½èƒ½è®¿é—®åˆ°ï¼Œä¸” <code class="language-plaintext highlighter-rouge">handleSubmit</code> å¹¶ä¸ä¼šå› ä¸º <code class="language-plaintext highlighter-rouge">text</code> çš„æ›´æ–°è€Œæ›´æ–°ï¼Œä¹Ÿå°±ä¸ä¼šè®© <code class="language-plaintext highlighter-rouge">OtherForm</code> å¤šæ¬¡æ¸²æŸ“ã€‚</p>

<hr />

<p>è¯„è®ºä¸­æœ‰ä¸ºæœ‹å‹æåˆ°æ˜¯å¦è¦æŠŠæ‰€æœ‰çš„æ–¹æ³•éƒ½ç”¨ useCallback åŒ…ä¸€å±‚å‘¢ï¼Œè¿™ä¸ªåº”è¯¥ä¹Ÿæ˜¯å¾ˆå¤šåˆšäº†è§£ useCallback çš„æœ‹å‹çš„ä¸€ç–‘é—®ã€‚å…ˆè¯´ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸è¦æŠŠæ‰€æœ‰çš„æ–¹æ³•éƒ½åŒ…ä¸Š useCallback</strong>ï¼Œä¸‹é¢ä»”ç»†è®²ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">count1</span><span class="p">,</span> <span class="nx">setCount1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">count2</span><span class="p">,</span> <span class="nx">setCount2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">handleClickButton1</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setCount1</span><span class="p">(</span><span class="nx">count1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">handleClickButton2</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setCount2</span><span class="p">(</span><span class="nx">count2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">count2</span><span class="p">]);</span>

<span class="k">return</span> <span class="p">(</span>
  <span class="o">&lt;&gt;</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClickButton1</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">button1</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleClickButton2</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">button2</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div></div>

<p>ä¸Šé¢è¿™ç§å†™æ³•åœ¨å½“å‰ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ä¼šå£°æ˜ä¸€ä¸ªæ–°çš„ <code class="language-plaintext highlighter-rouge">handleClickButton1</code> å‡½æ•°ï¼Œä¸‹é¢ <code class="language-plaintext highlighter-rouge">useCallback</code> é‡Œé¢çš„å‡½æ•°ä¹Ÿä¼šå£°æ˜ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¢«ä¼ å…¥åˆ° <code class="language-plaintext highlighter-rouge">useCallback</code> ä¸­ï¼Œå°½ç®¡è¿™ä¸ªå‡½æ•°æœ‰å¯èƒ½å› ä¸º <code class="language-plaintext highlighter-rouge">inputs</code> æ²¡æœ‰å‘ç”Ÿæ”¹å˜ä¸ä¼šè¢«è¿”å›åˆ° <code class="language-plaintext highlighter-rouge">handleClickButton2</code> å˜é‡ä¸Šã€‚</p>

<p>é‚£ä¹ˆåœ¨æˆ‘ä»¬è¿™ç§æƒ…å†µå®ƒè¿”å›æ–°çš„å‡½æ•°å’Œè€çš„å‡½æ•°ä¹Ÿéƒ½ä¸€æ ·ï¼Œå› ä¸ºä¸‹é¢ <code class="language-plaintext highlighter-rouge">&lt;button&gt;</code> å·²ç»éƒ½ä¼šè¢«æ¸²æŸ“ä¸€ä¸‹ï¼Œåè€Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">useCallback</code> åæ¯æ¬¡æ‰§è¡Œåˆ°è¿™é‡Œå†…éƒ¨è¦è¦æ¯”å¯¹ <code class="language-plaintext highlighter-rouge">inputs</code> æ˜¯å¦å˜åŒ–ï¼Œè¿˜æœ‰å­˜ä¸€ä¸‹ä¹‹å‰çš„å‡½æ•°ï¼Œæ¶ˆè€—æ›´å¤§äº†ã€‚</p>

<blockquote>
  <p>useCallback æ˜¯è¦é…åˆå­ç»„ä»¶çš„ <strong><code class="language-plaintext highlighter-rouge">shouldComponentUpdate</code></strong> æˆ–è€… <strong><code class="language-plaintext highlighter-rouge">React.memo</code></strong> ä¸€èµ·æ¥ä½¿ç”¨çš„ï¼Œå¦åˆ™å°±æ˜¯åå‘ä¼˜åŒ–ã€‚</p>
</blockquote>

<h2 id="usememo">useMemo</h2>

<h3 id="usememo-çš„ä½œç”¨">useMemo çš„ä½œç”¨</h3>

<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>

<blockquote>
  <p>Pass a â€œcreateâ€ function and an array of dependencies. useMemo will only recompute the memoized value when one of the dependencies has changed.</p>
</blockquote>

<p>ç®€å•æ¥è¯´å°±æ˜¯ä¼ é€’ä¸€ä¸ªåˆ›å»ºå‡½æ•°å’Œä¾èµ–é¡¹ï¼Œåˆ›å»ºå‡½æ•°ä¼šéœ€è¦è¿”å›ä¸€ä¸ªå€¼ï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ‰ä¼šé‡æ–°è°ƒç”¨æ­¤å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å€¼ã€‚</p>

<h3 id="usememo-çš„åº”ç”¨">useMemo çš„åº”ç”¨</h3>

<p>useMemo ä¸ useCallback å¾ˆåƒï¼Œæ ¹æ®ä¸Šè¿° useCallback å·²ç»å¯ä»¥æƒ³åˆ° useMemo ä¹Ÿèƒ½é’ˆå¯¹ä¼ å…¥å­ç»„ä»¶çš„å€¼è¿›è¡Œç¼“å­˜ä¼˜åŒ–ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">userInfo</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="na">age</span><span class="p">:</span> <span class="nx">count</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Jace</span><span class="dl">'</span>
<span class="p">}</span>

<span class="k">return</span> <span class="o">&lt;</span><span class="nx">UserCard</span> <span class="nx">userInfo</span><span class="o">=</span><span class="p">{</span><span class="nx">userInfo</span><span class="p">}</span><span class="o">&gt;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">userInfo</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Jace</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">age</span><span class="p">:</span> <span class="nx">count</span>
  <span class="p">};</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">count</span><span class="p">]);</span>

<span class="k">return</span> <span class="o">&lt;</span><span class="nx">UserCard</span> <span class="nx">userInfo</span><span class="o">=</span><span class="p">{</span><span class="nx">userInfo</span><span class="p">}</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>å¾ˆæ˜æ˜¾çš„ä¸Šé¢çš„ userInfo æ¯æ¬¡éƒ½å°†æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ— è®º <code class="language-plaintext highlighter-rouge">count</code> å‘ç”Ÿæ”¹å˜æ²¡ï¼Œéƒ½ä¼šå¯¼è‡´ UserCard é‡æ–°æ¸²æŸ“ï¼Œè€Œä¸‹é¢çš„åˆ™ä¼šåœ¨ <code class="language-plaintext highlighter-rouge">count</code> æ”¹å˜åæ‰ä¼šè¿”å›æ–°çš„å¯¹è±¡ã€‚</p>

<p>ä¸Šè¿°ç”¨æ³•æ˜¯æœ‰æœ‰å…³äºçˆ¶å­ç»„ä»¶ä¼ å€¼å¸¦æ¥çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå®é™…ä¸Š useMemo çš„ä½œç”¨<strong>ä¸æ­¢äºæ­¤</strong>ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£å†…ä»‹ç»ï¼š</p>

<blockquote>
  <p>This optimization helps to avoid expensive calculations on every render.</p>
</blockquote>

<p>å¯ä»¥æŠŠä¸€äº›æ˜‚è´µçš„è®¡ç®—é€»è¾‘æ”¾åˆ° useMemo ä¸­ï¼Œåªæœ‰å½“ä¾èµ–å€¼å‘ç”Ÿæ”¹å˜çš„æ—¶å€™æ‰å»æ›´æ–°ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">num</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// è¿™é‡Œä½¿ç”¨ count é’ˆå¯¹ num åšä¸€äº›å¾ˆå¤æ‚çš„è®¡ç®—ï¼Œå½“ count æ²¡æ”¹å˜çš„æ—¶å€™ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“å°±ä¼šç›´æ¥è¿”å›ä¹‹å‰ç¼“å­˜çš„å€¼ã€‚</span>
  <span class="k">return</span> <span class="nx">num</span><span class="p">;</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">count</span><span class="p">]);</span>

<span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">num</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div&gt;</span><span class="err">;
</span></code></pre></div></div>

<p>äº‹å®ä¸Šåœ¨ä½¿ç”¨ä¸­ useMemo çš„åœºæ™¯è¿œæ¯” useCallback è¦å¹¿æ³›çš„å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥å°† useMemo çš„è¿”å›å€¼å®šä¹‰ä¸ºè¿”å›ä¸€ä¸ªå‡½æ•°è¿™æ ·å°±å¯ä»¥å˜é€šçš„å®ç°äº† useCallbackã€‚åœ¨å¼€å‘ä¸­å½“æˆ‘ä»¬æœ‰éƒ¨åˆ†å˜é‡æ”¹å˜æ—¶ä¼šå½±å“åˆ°å¤šä¸ªåœ°æ–¹çš„æ›´æ–°é‚£æˆ‘ä»¬å°±å¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œé€šè¿‡è§£æ„èµ‹å€¼çš„æ–¹å¼æ¥å®ç°åŒæ—¶å¯¹å¤šä¸ªæ•°æ®çš„ç¼“å­˜ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">age</span><span class="p">,</span> <span class="nx">followUser</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="o">-</span> <span class="nx">userInfo</span><span class="p">.</span><span class="nx">birth</span><span class="p">,</span> <span class="c1">// æ ¹æ®ç”Ÿæ—¥è®¡ç®—å¹´é¾„</span>
    <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// å…³æ³¨ç”¨æˆ·</span>
      <span class="k">await</span> <span class="nx">request</span><span class="p">(</span><span class="dl">"</span><span class="s2">/follow</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">uid</span><span class="p">:</span> <span class="nx">userInfo</span><span class="p">.</span><span class="nx">id</span> <span class="p">});</span>
      <span class="c1">// ...</span>
    <span class="p">},</span>
  <span class="p">];</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">userInfo</span><span class="p">]);</span>

<span class="k">return</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="nx">name</span><span class="p">:</span> <span class="p">{</span><span class="nx">userInfo</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="nx">age</span><span class="p">:</span> <span class="p">{</span><span class="nx">age</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">Card</span> <span class="nx">followUser</span><span class="o">=</span><span class="p">{</span><span class="nx">followUser</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>    <span class="p">{</span><span class="nx">useMemo</span><span class="p">(</span>
      <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
        <span class="c1">// å¦‚æœ Card1 ç»„ä»¶å†…éƒ¨æ²¡æœ‰ä½¿ç”¨ React.memo å‡½æ•°ï¼Œé‚£è¿˜å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼åœ¨çˆ¶ç»„ä»¶å‡å°‘å­ç»„ä»¶çš„æ¸²æŸ“</span>
        <span class="o">&lt;</span><span class="nx">Card1</span> <span class="nx">followUser</span><span class="o">=</span><span class="p">{</span><span class="nx">followUser</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>      <span class="p">),</span>
      <span class="p">[</span><span class="nx">followUser</span><span class="p">]</span>
    <span class="p">)}</span>
  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="ç»“è¯­">ç»“è¯­</h2>

<p>ç®€å•ç†è§£å‘¢ useCallback ä¸ useMemo ä¸€ä¸ªç¼“å­˜çš„æ˜¯å‡½æ•°ï¼Œä¸€ä¸ªç¼“å­˜çš„æ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚useCallback æ˜¯æ¥ä¼˜åŒ–å­ç»„ä»¶çš„ï¼Œé˜²æ­¢å­ç»„ä»¶çš„é‡å¤æ¸²æŸ“ã€‚useMemo å¯ä»¥ä¼˜åŒ–å½“å‰ç»„ä»¶ä¹Ÿå¯ä»¥ä¼˜åŒ–å­ç»„ä»¶ï¼Œä¼˜åŒ–å½“å‰ç»„ä»¶ä¸»è¦æ˜¯é€šè¿‡ memoize æ¥å°†ä¸€äº›å¤æ‚çš„è®¡ç®—é€»è¾‘è¿›è¡Œç¼“å­˜ã€‚å½“ç„¶å¦‚æœåªæ˜¯è¿›è¡Œä¸€äº›ç®€å•çš„è®¡ç®—ä¹Ÿæ²¡å¿…è¦ä½¿ç”¨ useMemoï¼Œè¿™é‡Œå¯ä»¥è€ƒè™‘ä¸€äº›è®¡ç®—çš„æ€§èƒ½æ¶ˆè€—å’Œæ¯”è¾ƒ inputs çš„æ€§èƒ½æ¶ˆè€—æ¥åšä¸€ä¸ªæƒè¡¡ï¼ˆå¦‚æœçœŸæœ‰é€»è¾‘è·Ÿè¿™ä¸ªæ¯”è¾ƒé€»è¾‘å·®ä¸å¤šï¼Œä¹Ÿæ²¡å¿…è¦ä½¿ç”¨ useMemo ï¼Œè¿˜èƒ½å‡å°‘ä¸€ç‚¹å¯¹é”®ç›˜ç£¨æŸ ğŸ˜…ï¼‰ã€‚</p>

<p>ç»“æŸã€‚</p>

        <div class="date">å‘å¸ƒæ—¶é—´ï¼š2020-03-24</div>
      </div>
    </div>
    <div class="nav-container">
      <div class="main-nav">
        <div class="title">ç›®å½•</div>
      </div>
    </div>
  </div>
  <footer id="footer">
  <a title="Github" href="https://github.com/jaceyi">
    <i class="iconfont">&#xe600;</i>
  </a>
  <a title="æ˜é‡‘" href="https://juejin.im/user/5a3b2016f265da43231b22a7">
    <i class="iconfont">&#xe610;</i>
  </a>
  <a title="ä¸ªäººç½‘ç«™" href="https://jaceyi.com/">
    <i class="iconfont">&#xe789;</i>
  </a>
  <a title="Twitter" href="https://twitter.com/jaceyi123">
    <i class="iconfont">&#xe602;</i>
  </a>
</footer>

  <div class="back-top">
  <i class="iconfont">&#xe6d9;</i>
</div>
<script>
  (function (d, w) {
    function scrollTo(targetY) {
      var currentY =
        d.documentElement.scrollTop || d.body.scrollTop;
      var distance = targetY - currentY;
      var num = 0;

      function animate() {
        var currentY =
          d.documentElement.scrollTop || d.body.scrollTop;
        w.scrollTo(0, currentY + distance / 10);
        num++;
        if (num === 10) return;
        w.requestAnimationFrame(animate);
      }

      animate();
    }
    var $upTop = d.querySelector('.back-top');

    $upTop.onclick = function () {
      scrollTo(0);
    };

    function bindEvent() {
      var scrollTop = d.documentElement.scrollTop || d.body.scrollTop;
      if (scrollTop > 100) {
        $upTop.style.display = 'block';
      } else {
        $upTop.style.display = 'none';
      }
    }

    w.addEventListener('scroll', bindEvent);
    w.addEventListener('load', bindEvent);
  })(document, window);
</script>

  <script src="/js/prism.js"></script>
  <script>
    (function (w, d) {
      var $nav = document.querySelector('.main-nav');
      var $article = document.querySelector('.article');
      var titleNodeNames = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6'];
      var contentItems = [];
      var navItems = [];
      for (var i = 0; i < $article.children.length; i++) {
        var element = $article.children[i];
        if (titleNodeNames.includes(element.nodeName)) {
          var link = document.createElement('a');
          link.href = '#' + element.innerText;
          link.innerText = element.innerText;
          link.setAttribute('data-head', element.nodeName)

          $nav.appendChild(link);
          navItems.push(link);
          element.id = element.innerText;
          contentItems.push(element);
        }
      }

      function bindEvent() {
        var scrollTop = d.documentElement.scrollTop || d.body.scrollTop;
        for (var i = 0; i < navItems.length; i++) {
          removeClass(navItems[i], 'active');
        }
        for (var i = contentItems.length - 1; i >= 0; i--) {
          if (scrollTop >= getElementTop(contentItems[i])) {
            addClass(navItems[i], 'active');
            return;
          }
        }
        addClass(navItems[0], 'active');
      }
      w.addEventListener('scroll', bindEvent);
      w.addEventListener('load', bindEvent);
    })(window, document)
  </script>
</body>

</html>
